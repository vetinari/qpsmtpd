# this plugin checks the standard rcpthosts config
#
# It should be configured to be run _LAST_!
#
use Qpsmtpd::DSN;

sub hook_rcpt {
  my ($self, $transaction, $recipient, %param) = @_;

  return (OK) if $recipient->has_rcpthost();
  return (OK) if $self->qp->connection->relay_client; # failsafe
  # default of relaying_denied is obviously DENY, 
  # we use the default "Relaying denied" message...
  return Qpsmtpd::DSN->relaying_denied();
}
